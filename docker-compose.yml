
services:
  # ============================
  # ðŸŸ¥ MongoDB
  # ============================
  mongo:
    image: mongo:6
    container_name: hospital-mongo
    restart: always
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

  # ============================
  # ðŸŸ¥ Redis
  # ============================
  redis:
    image: redis:7
    container_name: hospital-redis
    restart: always
    ports:
      - "6379:6379"

  # ============================
  # ðŸŸ© Backend (Express)
  # ============================
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: hospital-backend
    restart: always
    environment:
      PORT: 5000
      MONGO_URI: mongodb://mongo:27017/hospital
      REDIS_HOST: redis
      REDIS_PORT: 6379
      NODE_PATH: /app:/common
    ports:
      - "5000:5000"
    depends_on:
      - mongo
      - redis
    volumes:
      - ./backend:/app
      - ./common:/common
      - backend_node_modules:/app/node_modules
      - common_node_modules:/common/node_modules

  # ============================
  # ðŸŸ¦ Frontend (Vite)
  # ============================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: hospital-frontend
    restart: always
    environment:
      VITE_BACKEND_URL: http://localhost:5000
      CHOKIDAR_USEPOLLING: "true"
    ports:
      - "5173:5173"
    depends_on:
      - backend
    volumes:
      - ./frontend:/app
      - /app/node_modules

  # ============================
  # ðŸŸª Intake Agent
  # ============================
  intake-agent:
    build:
      context: ./agents
      dockerfile: Dockerfile
    container_name: intake-agent
    command: npm run start:intake
    environment:
      MONGO_URI: mongodb://mongo:27017/hospital
      REDIS_HOST: redis
      REDIS_PORT: 6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      NODE_PATH: /app/node_modules
    depends_on:
      - mongo
      - redis
    volumes:
      - ./agents:/app
      - ./common:/common
      - agents_node_modules:/app/node_modules
      - common_node_modules:/common/node_modules

  # ============================
  # ðŸŸ« RAG Indexer Agent
  # ============================
  rag-agent:
    build:
      context: ./agents
      dockerfile: Dockerfile
    container_name: rag-agent
    command: npm run start:rag
    environment:
      MONGO_URI: mongodb://mongo:27017/hospital
      REDIS_HOST: redis
      REDIS_PORT: 6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      NODE_PATH: /app/node_modules
    depends_on:
      - mongo
      - redis
    volumes:
      - ./agents:/app
      - ./common:/common
      - agents_node_modules:/app/node_modules
      - common_node_modules:/common/node_modules

  # ============================
  # ðŸŸ§ Diagnostics Agent
  # ============================
  diagnostics-agent:
    build:
      context: ./agents
      dockerfile: Dockerfile
    container_name: diagnostics-agent
    command: npm run start:diagnostics
    environment:
      MONGO_URI: mongodb://mongo:27017/hospital
      REDIS_HOST: redis
      REDIS_PORT: 6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      TOP_K: 6
      NODE_PATH: /app/node_modules
    depends_on:
      - mongo
      - redis
    volumes:
      - ./agents:/app
      - ./common:/common
      - agents_node_modules:/app/node_modules
      - common_node_modules:/common/node_modules

  # ============================
  # ðŸŸ¨ Billing Agent
  # ============================
  billing-agent:
    build:
      context: ./agents
      dockerfile: Dockerfile
    container_name: billing-agent
    command: npm run start:billing
    environment:
      MONGO_URI: mongodb://mongo:27017/hospital
      REDIS_HOST: redis
      REDIS_PORT: 6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      NODE_PATH: /app/node_modules
    depends_on:
      - mongo
      - redis
    volumes:
      - ./agents:/app
      - ./common:/common
      - agents_node_modules:/app/node_modules
      - common_node_modules:/common/node_modules

  # ============================
  # ðŸŸ¦ Security Agent
  # ============================
  security-agent:
    build:
      context: ./agents
      dockerfile: Dockerfile
    container_name: security-agent
    command: npm run start:security
    environment:
      MONGO_URI: mongodb://mongo:27017/hospital
      REDIS_HOST: redis
      REDIS_PORT: 6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      NODE_PATH: /app/node_modules
    depends_on:
      - mongo
      - redis
    volumes:
      - ./agents:/app
      - ./common:/common
      - agents_node_modules:/app/node_modules
      - common_node_modules:/common/node_modules

volumes:
  mongo_data:
  backend_node_modules:
  common_node_modules:
  agents_node_modules:
